description = "风格一致性检测 - 验证创作内容与目标风格的匹配度"

prompt = """
使用 novel check-style CLI 命令检测创作文本与目标风格的一致性，提供四维度评分和改进建议。

用户输入：{{args}}

## 任务目标

科学评估创作文本与目标风格的匹配度，提供量化评分和具体改进建议。

## 检测维度

1. **词汇匹配度 (30%)**：词汇丰富度、高频词重叠度
2. **句法匹配度 (30%)**：句长对比、句式分布
3. **情感匹配度 (20%)**：情感倾向、情感得分
4. **节奏匹配度 (20%)**：句长变化、节奏模式

## 执行步骤

### 1. 确认文件路径
需要两个文件：
- **创作文本**：要检测的文本文件
- **风格配置**：目标风格的 JSON 文件（NLP 分析结果）

询问用户文件路径（如果未提供）。

### 2. 准备风格配置文件
如果用户没有风格配置文件，需要先生成：
```bash
# 分析目标风格样本
novel analyze clean/jinyong/射雕英雄传.txt -o nlp/jinyong/射雕英雄传.json
```

### 3. 执行一致性检测
运行以下命令：
```bash
novel check-style <创作文本> <风格配置>
```

示例：
```bash
novel check-style output/chapter-01.txt nlp/jinyong/射雕英雄传.json
```

### 4. 解读检测结果

#### 总体得分
- **90-100%**：高度一致 ⭐⭐⭐⭐⭐
- **75-89%**：基本一致 ⭐⭐⭐⭐
- **60-74%**：部分一致 ⭐⭐⭐
- **< 60%**：不一致 ⭐⭐

#### 各维度评分
为每个维度提供：
- 得分百分比
- 评级（完美/优秀/一般/较差）
- 具体建议

### 5. 生成检测报告
创建详细的检测报告：
```markdown
## 风格一致性检测报告

### 总体评估
- **得分**：[分数]% ([等级])
- **检测时间**：[时间]
- **创作文本**：[文件名]
- **目标风格**：[风格名]

### 各维度详情

#### 词汇匹配度：[分数]% ([评级])
- 词汇丰富度对比：[数据]
- 高频词重叠度：[数据]
- **建议**：[具体建议]

#### 句法匹配度：[分数]% ([评级])
- 平均句长对比：[数据]
- 句式分布相似度：[数据]
- **建议**：[具体建议]

#### 情感匹配度：[分数]% ([评级])
- 情感倾向一致性：[数据]
- 情感得分差异：[数据]
- **建议**：[具体建议]

#### 节奏匹配度：[分数]% ([评级])
- 句长变化对比：[数据]
- **建议**：[具体建议]

### 改进优先级
1. [最需要改进的维度]
2. [次要改进的维度]
3. [可选优化的维度]

### 具体改进建议
[针对性的修改建议]
```

### 6. 提供改进指导

根据各维度得分，提供具体改进方法：

**词汇层面**：
- 得分低：增加目标风格的特色词汇
- 丰富度不匹配：调整词汇多样性
- 高频词缺失：参考目标风格的高频词

**句法层面**：
- 句子过短/过长：调整平均句长
- 句式单一：增加句式变化
- 分布不均：平衡短中长句比例

**情感层面**：
- 倾向不一致：调整情感表达方式
- 得分差异大：调整情感强度

**节奏层面**：
- 节奏过快/过慢：调整句长变化
- 变化不足：增加节奏起伏

### 7. 迭代优化流程
建议用户按以下流程优化：
```
创作初稿
    ↓
检测评分 (第1次)
    ↓
得分 < 75%？
    ↓ 是
根据建议修改
    ↓
检测评分 (第2次)
    ↓
得分 ≥ 75%？
    ↓ 是
完成 ✅
```

### 8. 保存检测结果（可选）
如果用户需要保存详细结果：
```bash
novel check-style <创作文本> <风格配置> -o reports/check-result.json
```

## 评分标准参考

### 商业出版标准
- 目标得分：≥ 85%
- 各维度：≥ 80%

### 个人创作标准
- 目标得分：≥ 75%
- 各维度：≥ 70%

### 初稿练习标准
- 目标得分：≥ 60%
- 各维度：≥ 55%

## 批量检测示例

如果用户需要检测多个章节：
```bash
# Windows PowerShell
Get-ChildItem output/chapter-*.txt | ForEach-Object {
  novel check-style $_.FullName nlp/jinyong/射雕英雄传.json
}

# Unix/Linux/Mac
for file in output/chapter-*.txt; do
  novel check-style "$file" nlp/jinyong/射雕英雄传.json
done
```

## 完整工作流程

```bash
# 1. 准备样本（预处理）
novel preprocess samples/jinyong/射雕英雄传.txt -o clean/jinyong/射雕英雄传.txt

# 2. 分析样本（生成风格配置）
novel analyze clean/jinyong/射雕英雄传.txt -o nlp/jinyong/射雕英雄传.json

# 3. 学习风格（AI 命令）
/style-learn clean/jinyong/ --name="金庸风格"

# 4. 风格化创作（AI 命令）
/write-styled 第1章 初入江湖 --style="金庸风格"

# 5. 一致性检测（CLI 命令）
novel check-style output/chapter-01.txt nlp/jinyong/射雕英雄传.json

# 6. 根据建议修改

# 7. 再次检测验证
novel check-style output/chapter-01-revised.txt nlp/jinyong/射雕英雄传.json
```

## 常见问题处理

**问题1：找不到风格配置文件**
- 解决：先使用 `novel analyze` 生成配置文件

**问题2：得分过低（< 60%）**
- 原因：创作文本与目标风格差异较大
- 解决：重点优化得分最低的维度

**问题3：某个维度得分特别低**
- 解决：针对性修改该维度的特征

**问题4：多次修改后得分仍不理想**
- 原因：可能对目标风格理解不够
- 解决：重新学习样本，使用 /style-analyze 深入分析

## 完成提示
✅ 风格一致性检测完成！
- 得分 ≥ 75%：质量合格，可以继续创作
- 得分 < 75%：建议根据改进建议修改后重新检测
"""
